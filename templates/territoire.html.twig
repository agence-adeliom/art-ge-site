{% extends 'base.html.twig' %}

{% block title %}ÉcoBoussole : les résultats de votre territoire{% endblock %}
{% block description %}Grâce à l’autodiagnostic ÉcoBoussole, accédez au niveau d’engagement durable des prestataires touristiques de votre territoire pour comprendre leurs besoins et les accompagner.{% endblock %}
{% block robots %}<meta name="robots" content="noindex">{% endblock %}

{% block body %}

    {{ dump() }}

    <div>
        <div>
            <div>
                <p>Score de votre territoire</p>
                <p>{{ display_percentage(globals.percentageGlobal) }} (pour {{ globals.numberOfReponsesGlobal }} répondants)</p>
                <p>Score de la région</p>
                <p>{{ display_percentage(globals.percentageRegionGlobal) }} (pour {{ globals.numberOfReponsesRegionGlobal }} répondants)</p>
            </div>
            <div>
                <p>Détail par piliers du développement durable</p>
                <ul>
                    {% for pilier, percentageByPilier in globals.percentagesByPiliersGlobal %}
                        <li>{{ pilier }} : {{ display_percentage(percentageByPilier) }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div>
            <p>Nombres de répondants</p>
            <div>{{ globals.numberOfReponsesGlobal }} répondants </div>
            <ul>
                {% for typologie, repondantsByTypologieGlobal in globals.repondantsByTypologieGlobal %}
                    <li>{{ typologie }} : {{ repondantsByTypologieGlobal }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div>
        <div>
            <p>Score total par établissement</p>
            {% for typologie, percentageByTypology in scores.percentagesByTypology %}
                <li>{{ typologie }} : {{ display_percentage(percentageByTypology) }}</li>
            {% endfor %}
        </div>
    </div>

    <hr>

    <h1 class="font-bold">Pourcentage Total</h1>
    {{ display_percentage(globals.percentageGlobal) }}
    <h2 class="font-bold mt-4 grid grid-cols-2">Scores par thématique</h2>
    {% for percentage in scores.percentagesByThematiques %}
        <h3 class="font-bold mt-2">{{ percentage.name }}</h3>
        {{ display_percentage(percentage.value) }}
    {% endfor %}

    <div class="grid grid-cols-3">
        {% if territoire.area.value == 'region' %}
            {% if children is not empty %}
                <div>
                    <h2 class="font-bold mt-4">Liste des département du {{ territoire.name }}</h2>
                    <ul class="grid">
                        {% for child in children %}
                            <li>
                                <div class="grid grid-cols-2"><a href="{{ url('app_territoire_single', { identifier: child.slug }) }}">{{ child.name }}</a><p>{{ child.numberOfReponses }}</p></div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
            {% if subChildren is not empty %}
                <div>
                    <h2 class="font-bold mt-4">Liste des OT du {{ territoire.name }}</h2>
                    <ul class="grid">
                        {% for subChild in subChildren %}
                            <li>
                                <div class="grid grid-cols-2"><a href="{{ url('app_territoire_single', { identifier: subChild.slug }) }}">{{ subChild.name }}</a><p>{{ subChild.numberOfReponses }}</p></div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        {% endif %}

        {% if territoire.area.value == 'departement' %}
            <div>
                <h2 class="font-bold mt-4">Liste des OT du {{ territoire.name }}</h2>
                {% if children is not empty %}
                    <ul>
                        {% for child in children %}
                            <li>
                                <div class="grid grid-cols-2"><a href="{{ url('app_territoire_single', { identifier: child.slug }) }}">{{ child.name }}</a><p>{{ child.numberOfReponses }}</p></div>
                            </li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        {% endif %}

        {% if globals.repondantsGlobal is not empty %}
            <div>
                <h2 class="font-bold mt-4">Liste des répondants</h2>
                <ul class="grid">
                {% for repondant in globals.repondantsGlobal %}
                    <li>
                        <div>{{ repondant.typologie }}</div>
                        <div><a href="{{ url('app_resultat_single', { uuid: repondant.uuid }) }}">{{ repondant.company }}</a></div>
                        <div>{{ display_percentage(repondant.points, repondant.total) }}</div>
                    </li>
                {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>
{% endblock %}
